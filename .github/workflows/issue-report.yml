name: Cloud Status Daily Report

on:
  workflow_run:
    workflows: ["Cloud Service Status Monitor"]
    types: [completed]

permissions:
  issues: write
  contents: read

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set git user from secrets
        run: |
          git config --local user.name "${{ secrets.GIT_USER_NAME }}"
          git config --local user.email "${{ secrets.GIT_USER_EMAIL }}"
          echo "Using user: ${{ secrets.GIT_USER_NAME }} <${{ secrets.GIT_USER_EMAIL }}>"

      - name: Get current date
        id: date
        run: echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

      - name: Create Issue from status file
        uses: peter-evans/create-issue-from-file@v4
        with:
          title: "Cloud Status Report ${{ steps.date.outputs.date }}"
          content-filepath: data/cloud_status.json
          labels: cloud,status
